<Window x:Class="AGR_Project_Manager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:AGR_Project_Manager.Converters"
        mc:Ignorable="d"
        Title="AGR Project Manager"
        MinHeight="600" MinWidth="1200"
        Height="750" Width="1400"
        Background="#1e1d22"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Конвертеры -->
        <converters:PathToImageConverter x:Key="PathToImageConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

        <!-- Стиль для кнопок текстур -->
        <Style x:Key="TextureButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3a3a3a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4a4a4a"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="MinWidth" Value="50"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ===== ЛЕВАЯ ПАНЕЛЬ ===== -->
        <Border Grid.Column="0" Background="#252429">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Button x:Name="NewProjectBtn" 
                        Content="➕ Новый проект" 
                        Background="#4a7c59" 
                        Foreground="White" 
                        Margin="10" 
                        Padding="10,8"
                        FontWeight="SemiBold"
                        Cursor="Hand"
                        Click="NewProjectBtn_Click"/>

                <ListBox x:Name="ProjectsList" 
                         Grid.Row="1" 
                         Background="#2d2c35" 
                         BorderBrush="#3a3a3a" 
                         BorderThickness="1" 
                         Margin="10,0,10,10"
                         SelectionChanged="ProjectsList_SelectionChanged"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="Padding" Value="8"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#3a3a5a"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#353545"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding Name}" 
                                           Foreground="White" 
                                           VerticalAlignment="Center"
                                           TextTrimming="CharacterEllipsis"/>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="✏️" Tag="{Binding}" Background="#444" 
                                            Foreground="White" Margin="2" Padding="6,4" FontSize="10"
                                            ToolTip="Редактировать" Click="EditProject_Click"/>
                                    <Button Content="📋" Tag="{Binding}" Background="#444" 
                                            Foreground="White" Margin="2" Padding="6,4" FontSize="10"
                                            ToolTip="Дублировать" Click="CloneProject_Click"/>
                                    <Button Content="❌" Tag="{Binding}" Background="#ff4d4d" 
                                            Foreground="White" Margin="2" Padding="6,4" FontSize="10"
                                            ToolTip="Удалить" Click="DeleteProject_Click"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Блок "Утилиты" -->
                <Border Grid.Row="2" Background="#2d2c35" BorderBrush="#3a3a3a" 
        BorderThickness="1" Margin="10,0,10,10" Padding="8">
                    <StackPanel>
                        <TextBlock Text="🔧 Утилиты" Foreground="#aaa" FontSize="12" 
                   FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Button Content="🎨 RAL Colors" Background="#3a3a3a" Foreground="White" 
                Margin="0,0,0,6" Padding="8,6" Cursor="Hand" Click="RalColorsBtn_Click"/>
                        <Button Content="🔤 Name Generator" Background="#3a3a3a" Foreground="White" 
                Margin="0,0,0,6" Padding="8,6" Cursor="Hand" Click="NameGeneratorBtn_Click"/>
                        <Button Content="📁 Создать папку проекта" Background="#3a3a3a" Foreground="White" 
                Margin="0,0,0,6" Padding="8,6" Cursor="Hand" Click="CreateFolderBtn_Click"/>
                        <Button Content="🌍 GeoJSON Generator" Background="#3a3a3a" Foreground="White" 
        Margin="0,0,0,6" Padding="8,6" Cursor="Hand" Click="GeoJsonBtn_Click"/>

                        <Separator Background="#3a3a3a" Margin="0,4"/>

                        <Button Content="📖 Справка" Background="#3a3a3a" Foreground="White" 
                Margin="0,6,0,6" Padding="8,6" Cursor="Hand" Click="HelpBtn_Click"/>
                        <Button Content="📋 Актуальные требования" Background="#3a3a3a" Foreground="White" 
                Margin="0,0,0,0" Padding="8,6" Cursor="Hand" Click="RequirementsBtn_Click"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- ===== ПРАВАЯ ПАНЕЛЬ ===== -->
        <Border Grid.Column="1" Background="#1e1d22">
            <Grid>
                <!-- Заглушка -->
                <TextBlock x:Name="PlaceholderText"
                           Text="Выберите проект или создайте новый" 
                           Foreground="#aaa" FontSize="16" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>

                <!-- Панель проекта -->
                <Grid x:Name="ProjectPanel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Заголовок проекта -->
                    <Border Grid.Row="0" Background="#252429" Padding="15,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock x:Name="ProjectTitle" FontSize="20" FontWeight="Bold" Foreground="White"/>
                                <TextBlock x:Name="ProjectDescription" Foreground="#888" FontSize="12" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="➕ Добавить модель" Background="#4a7c59" Foreground="White" 
                                        Padding="12,6" Margin="5,0" Click="AddModel_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Вкладки моделей -->
                    <TabControl x:Name="ModelsTabControl" Grid.Row="1" Background="Transparent" 
                                BorderThickness="0" Margin="10,10,10,0"
                                SelectionChanged="ModelsTabControl_SelectionChanged">
                        <TabControl.ItemContainerStyle>
                            <Style TargetType="TabItem">
                                <Setter Property="Background" Value="#2d2c35"/>
                                <Setter Property="Foreground" Value="#aaa"/>
                                <Setter Property="Padding" Value="10,8"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TabItem">
                                            <Border x:Name="Border" Background="{TemplateBinding Background}" 
                                                    Padding="{TemplateBinding Padding}" Margin="0,0,2,0"
                                                    CornerRadius="4,4,0,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center" 
                                                               Margin="0,0,5,0"/>
                                                    <Button Content="✏️" FontSize="10" Background="Transparent" 
                                                            Foreground="#888" BorderThickness="0" Margin="2,0"
                                                            ToolTip="Переименовать" Tag="{Binding}"
                                                            Click="RenameModel_Click"/>
                                                    <Button Content="📋" FontSize="10" Background="Transparent" 
                                                            Foreground="#888" BorderThickness="0" Margin="2,0"
                                                            ToolTip="Дублировать" Tag="{Binding}"
                                                            Click="DuplicateModel_Click"/>
                                                    <Button Content="❌" FontSize="10" Background="Transparent" 
                                                            Foreground="#ff6b6b" BorderThickness="0" Margin="2,0"
                                                            ToolTip="Удалить" Tag="{Binding}"
                                                            Click="RemoveModel_Click"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#3a3a5a"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#353545"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TabControl.ItemContainerStyle>
                    </TabControl>

                    <!-- Панель UDIM -->
                    <Border Grid.Row="2" Background="#252429" Margin="10" CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Кнопки управления рядами -->
                            <Border Grid.Row="0" Background="#2a2a35" Margin="0" Padding="10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Верхняя строка - кнопки рядов и копирования -->
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <Button Content="➕ Добавить ряд" Background="#3a3a3a" Foreground="White" 
                    Padding="10,6" Margin="0,0,10,0" Click="AddUdimRow_Click"/>
                                        <Button Content="➖ Удалить верхний ряд" Background="#3a3a3a" Foreground="White" 
                    Padding="10,6" Margin="0,0,10,0" Click="RemoveUdimRow_Click"/>
                                        <Separator Width="1" Background="#4a4a4a" Margin="10,0"/>
                                        <Button x:Name="CopyTileBtn" Content="📋 Копировать" Background="#3a3a3a" 
                    Foreground="White" Padding="10,6" Margin="0,0,5,0" Click="CopyTile_Click"/>
                                        <Button x:Name="PasteTileBtn" Content="📥 Вставить" 
                    Padding="10,6" Click="PasteTile_Click">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Background" Value="#2a2a2a"/>
                                                    <Setter Property="Foreground" Value="#555"/>
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsEnabled" Value="True">
                                                            <Setter Property="Background" Value="#3a3a3a"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </StackPanel>

                                    <!-- Строка пресетов -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                                        <TextBlock Text="💾 Пресеты:" Foreground="#888" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <Button Content="➕ Сохранить как пресет" Background="#3a5a3a" Foreground="White" 
                    Padding="10,6" Margin="0,0,10,0" Click="SavePreset_Click"/>
                                        <ComboBox x:Name="PresetComboBox" 
                      Width="200" 
                      Margin="0,0,10,0"
                      DisplayMemberPath="Name"
                      SelectionChanged="PresetComboBox_SelectionChanged"/>
                                        <Button x:Name="ApplyPresetBtn" Content="📥 Применить" 
                    Padding="10,6" Margin="0,0,5,0" Click="ApplyPreset_Click">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Background" Value="#2a2a2a"/>
                                                    <Setter Property="Foreground" Value="#555"/>
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsEnabled" Value="True">
                                                            <Setter Property="Background" Value="#3a3a3a"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                        <Button x:Name="DeletePresetBtn" Content="🗑️" 
                    Padding="8,6" ToolTip="Удалить пресет" Click="DeletePreset_Click">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Background" Value="#2a2a2a"/>
                                                    <Setter Property="Foreground" Value="#555"/>
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsEnabled" Value="True">
                                                            <Setter Property="Background" Value="#5a3a3a"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </StackPanel>

                                    <!-- Нижняя строка - шаблон имени файла -->
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,0">
                                        <TextBlock Text="📄 Шаблон имени:" 
                       Foreground="#888" 
                       FontSize="11" 
                       VerticalAlignment="Center"
                       Margin="0,0,8,0"/>
                                        <Border Background="#1e1d22" 
                    CornerRadius="4" 
                    Padding="10,4">
                                            <TextBlock x:Name="FileNameTemplateText" 
                           Text="T_[Проект]_[Тип]_1.[UDIM].png" 
                           Foreground="#6a9955" 
                           FontSize="11" 
                           FontFamily="Consolas"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Сетка UDIM с адаптивным размером -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" 
                                          HorizontalScrollBarVisibility="Disabled">
                                <ItemsControl x:Name="UdimGrid" Margin="10">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <!-- Ряд UDIM - используем UniformGrid для равномерного распределения -->
                                            <ItemsControl ItemsSource="{Binding}" Margin="0,0,0,8">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <UniformGrid Rows="1" Columns="10"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <!-- Один UDIM тайл - квадратный -->
                                                        <Border Background="#2d2c35" 
                                                                BorderBrush="#3a3a3a" 
                                                                BorderThickness="1" 
                                                                Margin="3" 
                                                                CornerRadius="6"
                                                                MouseLeftButtonDown="UdimTile_MouseDown"
                                                                Cursor="Hand">
                                                            <!-- Делаем квадратным через Viewbox -->
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding HasAnyTexture}" Value="True">
                                                                            <Setter Property="BorderBrush" Value="#4a7c59"/>
                                                                            <Setter Property="BorderThickness" Value="2"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>

                                                            <Grid>
                                                                <!-- Фоновое изображение Diffuse -->
                                                                <Image Source="{Binding DiffusePath, Converter={StaticResource PathToImageConverter}}"
                                                                       Stretch="UniformToFill"
                                                                       Opacity="0.3"
                                                                       HorizontalAlignment="Stretch"
                                                                       VerticalAlignment="Stretch"/>

                                                                <!-- Контент поверх изображения -->
                                                                <Grid Margin="8">
                                                                    <Grid.RowDefinitions>
                                                                        <RowDefinition Height="Auto"/>
                                                                        <RowDefinition Height="*"/>
                                                                        <RowDefinition Height="Auto"/>
                                                                        <RowDefinition Height="Auto"/>
                                                                    </Grid.RowDefinitions>

                                                                    <!-- Название материала (сверху) -->
                                                                    <Border Grid.Row="0" 
                                                                            Background="#1e1d22" 
                                                                            CornerRadius="3" 
                                                                            Padding="4,2"
                                                                            Margin="0,0,0,5"
                                                                            HorizontalAlignment="Center"
                                                                            Cursor="Hand"
                                                                            MouseLeftButtonDown="RenameTile_Click">
                                                                        <TextBlock Text="{Binding DisplayName}" 
                                                                                   Foreground="#ccc" 
                                                                                   FontSize="11"
                                                                                   FontWeight="SemiBold"
                                                                                   TextTrimming="CharacterEllipsis"
                                                                                   MaxWidth="80"
                                                                                   HorizontalAlignment="Center"
                                                                                   ToolTip="Кликните для переименования"/>
                                                                    </Border>

                                                                    <!-- Пустое пространство для квадратности -->
                                                                    <Grid Grid.Row="1"/>

                                                                    <!-- Кнопки текстур (горизонтально) -->
                                                                    <StackPanel Grid.Row="2" 
                                                                                Orientation="Horizontal" 
                                                                                HorizontalAlignment="Center"
                                                                                Margin="0,5,0,5">
                                                                        <Button Content="D" Tag="Diffuse"
                                                                                Click="LoadTexture_Click"
                                                                                ToolTip="{Binding DiffusePath}"
                                                                                Width="28" Height="24" Padding="0"
                                                                                FontSize="10" FontWeight="Bold">
                                                                            <Button.Style>
                                                                                <Style TargetType="Button" BasedOn="{StaticResource TextureButtonStyle}">
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding HasDiffuse}" Value="True">
                                                                                            <Setter Property="Background" Value="#4a7c59"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </Button.Style>
                                                                        </Button>
                                                                        <Button Content="E" Tag="ERM"
                                                                                Click="LoadTexture_Click"
                                                                                ToolTip="{Binding ErmPath}"
                                                                                Width="28" Height="24" Padding="0"
                                                                                FontSize="10" FontWeight="Bold">
                                                                            <Button.Style>
                                                                                <Style TargetType="Button" BasedOn="{StaticResource TextureButtonStyle}">
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding HasErm}" Value="True">
                                                                                            <Setter Property="Background" Value="#7c5a4a"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </Button.Style>
                                                                        </Button>
                                                                        <Button Content="N" Tag="Normal"
                                                                                Click="LoadTexture_Click"
                                                                                ToolTip="{Binding NormalPath}"
                                                                                Width="28" Height="24" Padding="0"
                                                                                FontSize="10" FontWeight="Bold">
                                                                            <Button.Style>
                                                                                <Style TargetType="Button" BasedOn="{StaticResource TextureButtonStyle}">
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding HasNormal}" Value="True">
                                                                                            <Setter Property="Background" Value="#5a5a7c"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </Button.Style>
                                                                        </Button>
                                                                    </StackPanel>

                                                                    <!-- Номер UDIM (внизу) -->
                                                                    <Border Grid.Row="3" 
                                                                            Background="#1e1d22" 
                                                                            CornerRadius="3" 
                                                                            Padding="6,2"
                                                                            HorizontalAlignment="Center">
                                                                        <TextBlock Text="{Binding UdimNumber}" 
                                                                                   Foreground="#888" 
                                                                                   FontSize="11"
                                                                                   FontWeight="Bold"/>
                                                                    </Border>
                                                                </Grid>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <!-- Панель экспорта -->
                    <Border Grid.Row="3" Background="#252429" Padding="15" Margin="10,0,10,10" CornerRadius="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="📁 Папка экспорта:" Foreground="#aaa" VerticalAlignment="Center"/>
                                <TextBox x:Name="ExportPathTextBox" Width="400" Background="#2d2c35" 
                                         Foreground="White" BorderBrush="#3a3a3a" Padding="8,6" Margin="10,0"/>
                                <Button Content="..." Background="#3a3a3a" Foreground="White" 
                                        Padding="10,6" Click="BrowseExportPath_Click"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="📤 Экспорт текущей модели" Background="#4a7c59" Foreground="White" 
                                        Padding="15,8" Margin="0,0,10,0" FontWeight="SemiBold"
                                        Click="ExportCurrentModel_Click"/>
                                <Button Content="📤 Экспорт всех моделей" Background="#5a8c69" Foreground="White" 
                                        Padding="15,8" FontWeight="SemiBold"
                                        Click="ExportAllModels_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>